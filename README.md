# ChatGLM-CPU-Trainer

## é¡¹ç›®ç®€ä»‹

**ChatGLM-CPU-Trainer** æ˜¯ä¸€ä¸ªä¸“ä¸ºä½èµ„æºç¯å¢ƒè®¾è®¡çš„è®­ç»ƒå·¥å…·ï¼Œè®©æ™®é€šç”µè„‘ä¹Ÿèƒ½è®­ç»ƒå’Œå¾®è°ƒChatGLMå¤§æ¨¡å‹ã€‚æœ¬é¡¹ç›®ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæå¤§ç®€åŒ–äº†ç¯å¢ƒé…ç½®éš¾åº¦ã€‚

## â­ æ ¸å¿ƒç‰¹æ€§

- **CPUè®­ç»ƒ**ï¼šæ— éœ€GPUï¼Œæ™®é€šç”µè„‘ä¹Ÿèƒ½è®­ç»ƒ
- **ä½å†…å­˜ä¼˜åŒ–**ï¼šä»4GBåˆ°32GBå†…å­˜å‡å¯è¿è¡Œ
- **LoRAé«˜æ•ˆå¾®è°ƒ**ï¼šä½å‚æ•°é‡ã€é«˜æ•ˆç‡çš„å¾®è°ƒæ–¹æ³•
- **4-bit/8-bité‡åŒ–**ï¼šå¤§å¹…é™ä½å†…å­˜éœ€æ±‚
- **Dockerå®¹å™¨åŒ–**ï¼šä¸€é”®éƒ¨ç½²ï¼Œé¿å…å¤æ‚ç¯å¢ƒé…ç½®

## ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚

- Dockerå¼•æ“ (19.03+)
- æœ€ä½4GBå†…å­˜ï¼ˆæ¨è8GBä»¥ä¸Šï¼‰
- Windows/Linux/macOSç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/your-username/ChatGLM-CPU-Trainer.git
cd ChatGLM-CPU-Trainer
```

### 2. å‡†å¤‡æ•°æ®

å°†è®­ç»ƒæ•°æ®æ”¾å…¥`data/input/dataset.txt`ï¼ˆæ¯è¡Œä¸€æ¡è®­ç»ƒæ ·æœ¬ï¼‰

### 3. æ„å»ºDockeré•œåƒ

```bash
docker build -t chatglm-cpu-trainer .
```

### 4. è®­ç»ƒæ¨¡å‹

æ ¹æ®ç³»ç»Ÿå†…å­˜é€‰æ‹©åˆé€‚é…ç½®ï¼š

```bash
# 4GBå†…å­˜
docker-compose -f docker-compose-4gb.yml run train

# 8GBå†…å­˜
docker-compose -f docker-compose-8gb.yml run train

# æˆ–ä½¿ç”¨é»˜è®¤é…ç½®
docker-compose run train
```

### 5. æµ‹è¯•æ¨¡å‹

```bash
docker-compose run predict
```

## ğŸ“Š ä¸åŒå†…å­˜é…ç½®

| å†…å­˜ | é…ç½®æ–‡ä»¶ | é‡åŒ– | æœ€å¤§åºåˆ—é•¿åº¦ | æ ·æœ¬æ•° |
|------|----------|------|------------|-------|
| 4GB  | docker-compose-4gb.yml | 4bit | 32 | 30 |
| 8GB  | docker-compose-8gb.yml | 4bit | 64 | 200 |
| 16GB | docker-compose-16gb.yml | 8bit | 128 | 800 |
| 32GB | docker-compose-32gb.yml | None | 256 | 2000 |

## â“ å¸¸è§é—®é¢˜

- **å†…å­˜ä¸è¶³**ï¼šé€‰æ‹©æ›´ä½å†…å­˜é…ç½®æˆ–å‡å°‘æ ·æœ¬æ•°
- **è®­ç»ƒç¼“æ…¢**ï¼šCPUè®­ç»ƒæœ¬èº«è¾ƒæ…¢ï¼Œè€å¿ƒç­‰å¾…
- **æ¨¡å‹ä¸‹è½½å¤±è´¥**ï¼šæ£€æŸ¥ç½‘ç»œï¼Œä¿®æ”¹`HF_ENDPOINT`ç¯å¢ƒå˜é‡
- **é‡åŒ–å¤±è´¥**ï¼šå°è¯•éé‡åŒ–æ¨¡å¼ï¼ˆåœ¨å†…å­˜å…è®¸çš„æƒ…å†µä¸‹ï¼‰

## ğŸ“ å‚æ•°è¯´æ˜

ä¸»è¦å‚æ•°è¯´æ˜ï¼š
- `--quantization`: é‡åŒ–ç²¾åº¦ (4bit/8bit/None)
- `--max_seq_length`: æœ€å¤§åºåˆ—é•¿åº¦ï¼Œå½±å“å†…å­˜ä½¿ç”¨
- `--max_samples`: è®­ç»ƒæ ·æœ¬æ•°é‡
- `--lora_r`: LoRAç§©ï¼Œè¶Šå°å†…å­˜å ç”¨è¶Šä½
- `--gradient_accumulation_steps`: æ¢¯åº¦ç´¯ç§¯æ­¥æ•°ï¼Œè¶Šå¤§å†…å­˜å ç”¨è¶Šä½

## ğŸ“š ç›®å½•ç»“æ„

```
ChatGLM-CPU-Trainer/
â”œâ”€â”€ app/                    # åº”ç”¨ç¨‹åºä»£ç 
â”œâ”€â”€ data/                   # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ input/              # è¾“å…¥æ•°æ®
â”œâ”€â”€ models/                 # æ¨¡å‹å­˜å‚¨
â”œâ”€â”€ scripts/                # è¾…åŠ©è„šæœ¬
â”œâ”€â”€ Dockerfile              # Dockeræ„å»ºæ–‡ä»¶
â””â”€â”€ docker-compose*.yml     # ä¸åŒé…ç½®æ–‡ä»¶
```